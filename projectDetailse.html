<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Management System Documentation</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 40px;
            background-color: white;
        }
        h1 {
            color: #2c3e50;
            border-bottom: 2px solid #2c3e50;
            padding-bottom: 10px;
            margin-top: 0;
            font-size: 2.5em;
        }
        h2 {
            color: #2980b9;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
            margin-top: 40px;
            font-size: 1.8em;
        }
        h3 {
            color: #34495e;
            margin-top: 30px;
            font-size: 1.4em;
        }
        h4 {
            color: #555;
            margin-top: 20px;
            font-size: 1.2em;
        }
        code {
            background-color: #f8f9fa;
            border: 1px solid #e1e4e8;
            border-radius: 3px;
            padding: 2px 5px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            color: #d63384;
        }
        pre {
            background-color: #f6f8fa;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            padding: 16px;
            overflow-x: auto;
            margin: 20px 0;
        }
        pre code {
            background-color: transparent;
            border: none;
            padding: 0;
            color: #24292e;
            display: block;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #dfe2e5;
            padding: 10px 15px;
            text-align: left;
        }
        th {
            background-color: #f6f8fa;
            font-weight: 600;
        }
        tr:nth-child(even) {
            background-color: #fcfcfc;
        }
        .toc {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 40px;
            border: 1px solid #e9ecef;
        }
        .toc h2 {
            margin-top: 0;
            border-bottom: none;
            color: #333;
        }
        .toc ul {
            list-style-type: none;
            padding-left: 0;
        }
        .toc li {
            margin-bottom: 8px;
        }
        .toc a {
            text-decoration: none;
            color: #0366d6;
        }
        .toc a:hover {
            text-decoration: underline;
        }
        .note {
            background-color: #fff3cd;
            border-left: 5px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
        }
        @media print {
            body {
                padding: 0;
                max-width: 100%;
            }
            h1, h2 {
                page-break-after: avoid;
            }
            pre, table {
                page-break-inside: avoid;
            }
            a {
                text-decoration: none;
                color: #000;
            }
        }
    </style>
</head>
<body>
    <h1>User Management System</h1>
    <p><strong>Comprehensive Technical Documentation</strong></p>
    <div class="toc">
        <h2>Table of Contents</h2>
        <ul>
            <li>1. <a href="#intro">Introduction</a></li>
            <li>2. <a href="#arch">Project Architecture & Technology Stack</a></li>
            <li>3. <a href="#structure">Project Directory Structure</a></li>
            <li>4. <a href="#deps">Dependencies & Configuration</a></li>
            <li>5. <a href="#core">Core Infrastructure</a></li>
            <li>6. <a href="#data">Data Layer</a></li>
            <li>7. <a href="#middleware">Middleware & Security</a></li>
            <li>8. <a href="#module-user">Feature Implementation: User Module</a></li>
            <li>9. <a href="#module-admin">Feature Implementation: Admin Module</a></li>
            <li>10. <a href="#views">Presentation Layer (Views)</a></li>
        </ul>
    </div>
    <h2 id="intro">1. Introduction</h2>
    <p>This document provides an exhaustive, step-by-step technical analysis of the <strong>User Management System</strong>. This application is a web-based platform built using Node.js and Express that provides authentication (Login/Signup) for users and a comprehensive dashboard for administrators to manage those users.</p>
    <p>The system implements the <strong>MVC (Model-View-Controller)</strong> architectural pattern, ensuring a clean separation of concerns:</p>
    <ul>
        <li><strong>Model</strong>: Defines the data structure (User schema).</li>
        <li><strong>View</strong>: Handles the user interface (HTML/Handlebars).</li>
        <li><strong>Controller</strong>: Manages the application logic and acts as a bridge between Models and Views.</li>
    </ul>
    <h2 id="arch">2. Project Architecture & Technology Stack</h2>
    <h3>Technology Stack</h3>
    <ul>
        <li><strong>Runtime Environment</strong>: Node.js</li>
        <li><strong>Web Framework</strong>: Express.js (v5.2.1)</li>
        <li><strong>Database</strong>: MongoDB (via Mongoose ODM)</li>
        <li><strong>Template Engine</strong>: HBS (Handlebars)</li>
        <li><strong>Session Management</strong>: <code>express-session</code> with <code>dotenv</code> for secret management.</li>
        <li><strong>Styling</strong>: Tailwind CSS (via CDN).</li>
    </ul>
    <h3>Architecture Flow</h3>
    <ol>
        <li><strong>Request Entry</strong>: A client (browser) sends a request to the server.</li>
        <li><strong>Application Entry (<code>app.js</code>)</strong>: The main application file receives the request.</li>
        <li><strong>Middleware Processing</strong>: Global middleware (Body parsers, Session, NoCache) processes the request.</li>
        <li><strong>Routing</strong>: The request is routed to the appropriate module (<code>/admin</code> or <code>/</code>).</li>
        <li><strong>Controller Action</strong>: Specific controller functions execute business logic (querying DB, validating input).</li>
        <li><strong>Database Interaction</strong>: Mongoose models interact with the MongoDB database.</li>
        <li><strong>Response Rendering</strong>: The controller renders a View (HBS file) or redirects the user.</li>
        <li><strong>Client Response</strong>: The final HTML is sent back to the browser.</li>
    </ol>
    <h2 id="structure">3. Project Directory Structure</h2>
    <pre><code>user-admin-full-domain/
├── config/                 # Configuration files
│   └── session.js          # Session middleware configuration
├── controller/             # Business logic handlers
│   ├── acontroller.js      # Admin controller (login, user mgmt)
│   └── ucontroller.js      # User controller (signup, login)
├── middleware/             # Request interceptors
│   ├── adminauth.js        # Admin session checks
│   └── userauth.js         # User session checks
├── models/                 # Mongoose schemas
│   └── userModel.js        # User database schema
├── routes/                 # Route definitions
│   ├── admin.js            # Admin-specific routes
│   └── user.js             # User-specific routes
├── views/                  # Handlebars templates
│   ├── admin/              # Admin views (home, login)
│   └── user/               # User views (home, login, signup)
├── public/                 # Static assets (CSS, JS, Images)
├── app.js                  # Main application entry point
├── db.js                   # Database connection logic
├── package.json            # Project metadata & dependencies
└── .env                    # Environment variables (sensitive data)</code></pre>
    <h2 id="deps">4. Dependencies & Configuration (<code>package.json</code>)</h2>
    <p>The <code>package.json</code> file defines the project's identity and dependencies.</p>
    <p><strong>Key Dependencies:</strong></p>
    <ul>
        <li><strong><code>express</code></strong>: The core web framework.</li>
        <li><strong><code>mongoose</code></strong>: Object Data Modeling (ODM) library for MongoDB and Node.js. Used to define schemas and interact with the database.</li>
        <li><strong><code>express-session</code></strong>: Middleware to manage user sessions (login states).</li>
        <li><strong><code>nocache</code></strong>: Middleware to disable client-side caching, ensuring users can't click "Back" to view protected pages after logging out.</li>
        <li><strong><code>dotenv</code></strong>: Loads environment variables from a <code>.env</code> file into <code>process.env</code>.</li>
    </ul>
    <h2 id="core">5. Core Infrastructure</h2>
    <h3>5.1 Server Initialization (<code>app.js</code>)</h3>
    <p>This is the "brain" of the application.</p>
    <p><strong>Detailed Walkthrough:</strong></p>
    <ol>
        <li><strong>Imports</strong>: All necessary libraries and local modules are imported.
<pre><code>import express from 'express';
import path from 'path';
// ... imports for db, routes, config</code></pre>
        </li>
        <li><strong>Path Configuration</strong>:
<pre><code>const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);</code></pre>
            Since the project uses ES Modules (<code>"type": "module"</code>), <code>__dirname</code> is not available by default. This reconstructs it.
        </li>
        <li><strong>App & Database</strong>:
<pre><code>const app = express();
connectDB(); // Establishes connection to MongoDB</code></pre>
        </li>
        <li><strong>View Engine Setup</strong>:
<pre><code>app.set('views', path.join(__dirname, 'views'));
app.set('view engine', 'hbs');</code></pre>
        </li>
        <li><strong>Global Middleware</strong>: Use of <code>express.urlencoded</code>, <code>express.json</code>, <code>sessionMiddleware</code>, and <code>nocache()</code>.</li>
        <li><strong>Custom Cache Control Middleware</strong>: Explicitly sets 'no-store' headers to prevent back-button access.</li>
        <li><strong>Routes Mounting</strong>:
<pre><code>app.use('/admin', adminRoute); // All admin URLs start with /admin
app.use(userRoute);            // User URLs are at the root level</code></pre>
        </li>
    </ol>
    <h3>5.2 Database Connection (<code>db.js</code>)</h3>
<pre><code>const connectDB = async () => {
    try {
        const conn = await mongoose.connect("mongodb://localhost:27017/userA");
        console.log("mongodb connected");
    } catch (error) {
        console.log(error);
    }
}</code></pre>
    <p>Connects to local MongoDB instance <code>userA</code> on port 27017.</p>
    <h3>5.3 Session Management (<code>config/session.js</code>)</h3>
<pre><code>const sessionMiddleware = session({
    secret: process.env.sessionpass, // Secret from .env
    resave: false,
    saveUninitialized: false,
    cookie: { maxAge: 1000 * 60 * 60 * 24, httpOnly: true }, // 24 Hours
});</code></pre>
    <h2 id="data">6. Data Layer (<code>models/userModel.js</code>)</h2>
<pre><code>const userSchema = new mongoose.Schema({
  email: { type: String, required: true },
  password: { type: String, required: true },
  isBlocked: { type: Boolean, default: false }
});</code></pre>
    <p><strong>Field Analysis:</strong></p>
    <ul>
        <li><strong><code>email</code></strong>: Authenticates the user.</li>
        <li><strong><code>password</code></strong>: Stores the user's password.</li>
        <li><strong><code>isBlocked</code></strong>: Controlled by Admins. If <code>true</code>, the user is denied access.</li>
    </ul>
    <h2 id="middleware">7. Middleware & Security</h2>
    <h3>7.1 Admin Authentication (<code>middleware/adminauth.js</code>)</h3>
    <ul>
        <li><strong><code>isLogin</code></strong>: Prevents logged-in admins from seeing login page. Redirects to <code>/admin/home</code>.</li>
        <li><strong><code>checkSession</code></strong>: Protects dashboard. If not logged in, redirects to <code>/admin/login</code>.</li>
    </ul>
    <h3>7.2 User Authentication (<code>middleware/userauth.js</code>)</h3>
    <ul>
        <li><strong><code>loginCheckSession</code></strong>: Protects home page. If not logged in, redirects to <code>/login</code>.</li>
        <li><strong><code>isLogin</code></strong>: Redirects logged-in users away from Login/Signup pages.</li>
    </ul>
    <h2 id="module-user">8. Feature Implementation: User Module</h2>
    <h3>8.1 User Routes (<code>routes/user.js</code>)</h3>
    <table>
        <thead>
            <tr>
                <th>Method</th>
                <th>Path</th>
                <th>Middleware</th>
                <th>Purpose</th>
            </tr>
        </thead>
        <tbody>
            <tr><td>GET</td><td>/login</td><td>isLogin</td><td>Render login page</td></tr>
            <tr><td>POST</td><td>/login</td><td>None</td><td>Process login</td></tr>
            <tr><td>GET</td><td>/signup</td><td>isLogin</td><td>Render signup page</td></tr>
            <tr><td>POST</td><td>/signup</td><td>None</td><td>Process signup</td></tr>
            <tr><td>GET</td><td>/home</td><td>loginCheckSession</td><td>Render dashboard</td></tr>
        </tbody>
    </table>
    <h3>8.2 User Controller Logic (<code>controller/ucontroller.js</code>)</h3>
    <h4>Signup Logic</h4>
    <p>Checks if user exists using <code>findOne({ email })</code>. If not, creates new user and saves to DB. Automatically logs user in by setting <code>req.session.user</code>.</p>
    <h4>Login Logic</h4>
    <p>Finds user by email. Checks if <code>isBlocked</code> is true (security feature). Verifies password. If valid, sets session and redirects to home.</p>
    <h2 id="module-admin">9. Feature Implementation: Admin Module</h2>
    <h3>9.1 Admin Routes (<code>routes/admin.js</code>)</h3>
    <p>Routes include <code>/login</code>, <code>/home</code>, <code>/edit-user</code>, <code>/delete-user</code>, <code>/user-restrict</code>, and <code>/search-user</code>.</p>
    <h3>9.2 Admin Controller Logic (<code>controller/acontroller.js</code>)</h3>
    <ul>
        <li><strong>Login</strong>: Hardcoded credentials (email: "a@gmail.com", pass: "12345678").</li>
        <li><strong>Dashboard</strong>: Fetches all users via <code>userModel.find()</code>.</li>
        <li><strong>Edit User</strong>: Updates email using <code>findByIdAndUpdate</code>.</li>
        <li><strong>Block/Unblock</strong>: Toggles <code>isBlocked</code> boolean flag and saves.</li>
        <li><strong>Search</strong>: Uses MongoDB Regex <code>{ $regex: search, $options: 'i' }</code> for partial case-insensitive matching.</li>
    </ul>
    <h2 id="views">10. Presentation Layer (Views)</h2>
    <p>Uses <strong>Handlebars (HBS)</strong> for Templating.</p>
    <ul>
        <li><strong><code>{{ variable }}</code></strong>: For injecting dynamic data (emails, messages).</li>
        <li><strong><code>{{#if ...}}</code></strong>: For conditional rendering (alerts, error messages).</li>
        <li><strong><code>{{#each users}}</code></strong>: For iterating over user lists in the admin dashboard.</li>
    </ul>
    <p><strong>Lifecycle Example - Blocking a User:</strong></p>
    <ol>
        <li>Admin clicks "Restrict".</li>
        <li>Request hits <code>/admin/user-restrict/:id</code>.</li>
        <li>Controller toggles <code>isBlocked</code> to true.</li>
        <li>User is redirected to Admin Home.</li>
        <li>If the blocked user tries to access Home, <code>ucontroller.loadHome</code> checks the database, sees <code>isBlocked: true</code>, destroys their session, and kicks them out.</li>
    </ol>
</body>
</html>